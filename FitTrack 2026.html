<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FitTrack 2026 - Ê∏õËÑÇÊà∞È¨•Á¥ÄÈåÑ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 1. React Core -->
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- 2. Dependencies for Recharts -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/react-is@18.2.0/umd/react-is.production.min.js"></script>

    <!-- 3. Recharts (Stable UMD Version) -->
    <script src="https://unpkg.com/recharts@2.12.3/umd/Recharts.js"></script>
    
    <!-- 4. Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-area-pb { padding-bottom: env(safe-area-inset-bottom); }
        body { background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            filter: invert(0.5);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const Recharts = window.Recharts || {};
        const { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, Line, ComposedChart, Bar } = Recharts;

        // --- ÂÖßÂª∫ SVG ÂúñÊ®ôÂÖÉ‰ª∂ ---
        const IconBase = ({ children, color = "currentColor", size = 24, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                {children}
            </svg>
        );

        const Dumbbell = (props) => <IconBase {...props}><path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m3 10 7-7"/><path d="m14 21 7-7"/></IconBase>;
        const Scale = (props) => <IconBase {...props}><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></IconBase>;
        const TrendingDown = (props) => <IconBase {...props}><polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/></IconBase>;
        const Calendar = (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></IconBase>;
        const CheckCircle2 = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></IconBase>;
        const Circle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/></IconBase>;
        const Plus = (props) => <IconBase {...props}><path d="M5 12h14"/><path d="M12 5v14"/></IconBase>;
        const Save = (props) => <IconBase {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>;
        const LayoutDashboard = (props) => <IconBase {...props}><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></IconBase>;
        const History = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></IconBase>;
        const Settings = (props) => <IconBase {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconBase>;
        const Trophy = (props) => <IconBase {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></IconBase>;
        const Utensils = (props) => <IconBase {...props}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></IconBase>;
        const Flame = (props) => <IconBase {...props}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3Z"/></IconBase>;
        const Activity = (props) => <IconBase {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></IconBase>;
        const Timer = (props) => <IconBase {...props}><line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/></IconBase>;
        const Footprints = (props) => <IconBase {...props}><path d="M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 11 3.8 11 8c0 1.25-1 2-1 2.5 0 .83.67 1.5 1.5 1.5H12c.55 0 1 .45 1 1v2.38c0 2.12 1.03 3.12 1 5.62-.03 2.72-1.49 6-4.5 6C7.63 22 6 20.2 6 16c0-1.25 1-2 1-2.5 0-.83-.67-1.5-1.5-1.5H5c-.55 0-1-.45-1-1Z"/></IconBase>;
        const FileText = (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></IconBase>;
        const AlertCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>;
        const Zap = (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>;
        const Edit = (props) => <IconBase {...props}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></IconBase>;
        const RotateCcw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>;
        const PlusCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="16"/><line x1="8" x2="16" y1="12" y2="12"/></IconBase>;

        // --- Â∏∏Ë¶ãÈ£üÁâ©Ë≥áÊñôÂ∫´ (ÂÆåÊï¥Êì¥ÂÖÖÁâà) ---
        const COMMON_FOODS = [
            { category: 'Êó©È§êÊé®Ëñ¶', items: [
                { name: 'ÈÆ™È≠öËõãÈ§Ö', cal: 350, pro: 12 },
                { name: 'ÁéâÁ±≥ËõãÈ§Ö', cal: 300, pro: 8 },
                { name: 'ÂéüÂë≥ËõãÈ§Ö', cal: 260, pro: 7 },
                { name: 'Ëµ∑Âè∏ËõãÈ§Ö', cal: 320, pro: 10 },
                { name: 'Ë±¨ÊéíËõãÂêêÂè∏', cal: 400, pro: 18 },
                { name: 'ÁÅ´ËÖøËõãÂêêÂè∏', cal: 350, pro: 12 },
                { name: 'ÂüπÊ†πËõãÂêêÂè∏', cal: 380, pro: 14 },
                { name: 'Âç°ÊãâÈõûËÖøÂ†°', cal: 650, pro: 20 },
                { name: 'ÈêµÊùøÈ∫µ (ÈªëËÉ°Ê§í/ËòëËèá)', cal: 450, pro: 10 },
                { name: 'ËòøËîîÁ≥ï (3Áâá)', cal: 300, pro: 5 },
                { name: 'Ëç∑ÂåÖËõã (1È°Ü)', cal: 120, pro: 7 },
                { name: 'Ë±ÜÊºø (ÊúâÁ≥ñ 400ml)', cal: 240, pro: 14 },
                { name: 'ÁÑ°Á≥ñË±ÜÊºø (400ml)', cal: 135, pro: 14 },
                { name: 'Á±≥Êºø (400ml)', cal: 250, pro: 3 },
            ]},
            { category: 'Ê≠£È§ê (Âçà/Êôö)', items: [
                { name: 'ÈõûËÇâÈ£Ø‰æøÁï∂', cal: 700, pro: 25 },
                { name: 'Êª∑ÈõûËÖø‰æøÁï∂', cal: 800, pro: 28 },
                { name: 'ÁÇ∏ÈõûËÖø‰æøÁï∂', cal: 950, pro: 28 },
                { name: 'ÊéíÈ™®‰æøÁï∂ (ÁÇ∏)', cal: 900, pro: 25 },
                { name: 'ÊéíÈ™®‰æøÁï∂ (Êª∑)', cal: 800, pro: 25 },
                { name: 'ÊãõÁâå/ÊéßËÇâ‰æøÁï∂', cal: 850, pro: 20 },
                { name: 'Ê∞¥È§É (10È°Ü)', cal: 500, pro: 20 },
                { name: 'ÈçãË≤º (10È°Ü)', cal: 750, pro: 20 },
                { name: 'ÁâõËÇâÈ∫µ (Á¥ÖÁáí)', cal: 800, pro: 30 },
                { name: 'ÁâõËÇâÈ∫µ (Ê∏ÖÁáâ)', cal: 600, pro: 30 },
                { name: 'ÈôΩÊò•È∫µ (‰πæ)', cal: 400, pro: 8 },
                { name: 'È∫ªÈÜ¨È∫µ', cal: 550, pro: 10 },
                { name: 'ÂíñÂì©ÈõûËÇâÈ£Ø', cal: 750, pro: 20 },
                { name: 'ÁÇíÈ£Ø (ËÇâÁµ≤)', cal: 700, pro: 15 },
            ]},
            { category: 'È∫•Áï∂Âãû/ÈÄüÈ£ü', items: [
                { name: 'Â§ßÈ∫•ÂÖã', cal: 530, pro: 24 },
                { name: 'ÈõôÂ±§ÁâõËÇâÂêâ‰∫ãÂ†°', cal: 450, pro: 25 },
                { name: 'È∫•È¶ôÈ∑Ñ', cal: 360, pro: 15 },
                { name: 'È∫•È¶ôÈ≠ö', cal: 330, pro: 15 },
                { name: 'ÂãÅËæ£È∑ÑËÖøÂ†°', cal: 490, pro: 20 },
                { name: 'È∫•ÂÖãÈõûÂ°ä (6Â°ä)', cal: 280, pro: 15 },
                { name: 'È∫•ÂÖãÈõûÂ°ä (10Â°ä)', cal: 460, pro: 26 },
                { name: 'ËñØÊ¢ù (‰∏≠)', cal: 380, pro: 4 },
                { name: 'ËñØÊ¢ù (Â§ß)', cal: 530, pro: 6 },
                { name: 'Ë±¨ËÇâÊªøÁ¶èÂ†°Âä†Ëõã', cal: 380, pro: 20 },
                { name: 'ËñØÈ§Ö', cal: 150, pro: 1 },
                { name: 'ËõãÊç≤ÂÜ∞Ê∑áÊ∑ã', cal: 145, pro: 3 },
                { name: 'ÁéâÁ±≥ÊπØ (Â∞è)', cal: 90, pro: 2 },
                { name: 'ËÇØÂæ∑Âü∫ÂíîÂï¶ËÑÜÈõû (1Â°ä)', cal: 236, pro: 16 },
                { name: 'ËÇØÂæ∑Âü∫ËõãÂ°î (1È°Ü)', cal: 182, pro: 2 },
            ]},
            { category: 'Ê∂àÂ§ú/ÁÇ∏Áâ©/ÈªûÂøÉ', items: [
                { name: 'ÈπΩÈÖ•Èõû (1‰ªΩ)', cal: 500, pro: 30 },
                { name: 'ÁÇ∏ÈõûÊéí (1Áâá)', cal: 650, pro: 40 },
                { name: 'Áîú‰∏çËæ£ (1‰ªΩ)', cal: 300, pro: 5 },
                { name: 'Á±≥Ë°ÄÁ≥ï (1ÊîØ)', cal: 300, pro: 5 },
                { name: 'Ê≥°È∫µ (ÁÇ∏ÈÜ¨È∫µ)', cal: 500, pro: 8 },
                { name: 'Ê≥°È∫µ (Áµ±‰∏ÄËÇâÁá•)', cal: 400, pro: 7 },
                { name: 'Ê¥ãËäãÁâá (1ÂåÖ)', cal: 400, pro: 4 },
                { name: 'Ëå∂ËëâËõã', cal: 75, pro: 7 },
                { name: 'ÈÆ™È≠öÂæ°È£ØÁ≥∞', cal: 200, pro: 5 },
                { name: 'ÁÑ°Ë™øÂë≥Â†ÖÊûú (30g)', cal: 180, pro: 5 },
            ]},
            { category: 'ÂÅ•Â∫∑/Ëá™ÁÖÆ (ÊØè100g)', items: [
                { name: 'ÁôΩÈ£Ø (1Á¢ó 160g)', cal: 280, pro: 6 },
                { name: 'Á≥ôÁ±≥È£Ø (1Á¢ó 160g)', cal: 232, pro: 5 },
                { name: 'Âú∞Áìú (‰∏≠ 150g)', cal: 165, pro: 2 },
                { name: 'ÈõûËÉ∏ËÇâ (100g)', cal: 110, pro: 23 },
                { name: 'ÈõûËÖøËÇâ (ÂéªÁöÆ 100g)', cal: 160, pro: 20 },
                { name: 'ÁâõËÖ± (100g)', cal: 140, pro: 20 },
                { name: 'ÁÖéÈÆ≠È≠ö (100g)', cal: 200, pro: 20 },
                { name: 'Âè∞ÁÅ£ÈØõ (100g)', cal: 100, pro: 20 },
                { name: 'Ê∞¥ÁÖÆËõã (1È°Ü)', cal: 70, pro: 7 },
                { name: 'ÊùøË±ÜËÖê (ÂçäÁõí)', cal: 130, pro: 12 },
                { name: 'È´òËõãÁôΩÁ≤â (1‰ªΩ)', cal: 120, pro: 25 },
                { name: 'ÁáôÈùíËèú (1‰ªΩ)', cal: 40, pro: 2 },
                { name: 'ËòãÊûú (1È°Ü)', cal: 60, pro: 0 },
                { name: 'È¶ôËïâ (1Ê†π)', cal: 90, pro: 1 },
            ]}
        ];

        const DEFAULT_WORKOUTS = [
            {
                id: 'push',
                type: 'strength',
                name: 'Êé® (ËÉ∏/ËÇ©/‰∏âÈ†≠)',
                exercises: [
                    { name: 'ÊßìÈà¥Ëá•Êé®', defaultSets: 4, defaultReps: '8-12' },
                    { name: '‰∏äÊñúÂïûÈà¥Ëá•Êé®', defaultSets: 3, defaultReps: '10-12' },
                    { name: 'ÂïûÈà¥ËÇ©Êé®', defaultSets: 4, defaultReps: '10-12' },
                    { name: '‰∏âÈ†≠ËÇåÊªëËº™‰∏ãÂ£ì', defaultSets: 3, defaultReps: '12-15' },
                    { name: 'ÂïûÈà¥ÂÅ¥Âπ≥Ëàâ', defaultSets: 4, defaultReps: '15-20' },
                ]
            },
            {
                id: 'pull',
                type: 'strength',
                name: 'Êãâ (ËÉå/‰∫åÈ†≠/ÂæåËÇ©)',
                exercises: [
                    { name: 'ÂºïÈ´îÂêë‰∏ä/ÊªëËº™‰∏ãÊãâ', defaultSets: 4, defaultReps: '8-12' },
                    { name: 'ÊßìÈà¥ÂàíËàπ', defaultSets: 4, defaultReps: '8-12' },
                    { name: 'ËáâÊãâ (Face Pull)', defaultSets: 3, defaultReps: '15-20' },
                    { name: 'ÊßìÈà¥‰∫åÈ†≠ÂΩéËàâ', defaultSets: 3, defaultReps: '10-12' },
                    { name: 'ÂñÆËáÇÂïûÈà¥ÂàíËàπ', defaultSets: 3, defaultReps: '10-12' },
                ]
            },
            {
                id: 'legs',
                type: 'strength',
                name: 'ËÖø (ËÇ°ÂõõÈ†≠/ËÖøÂæå)',
                exercises: [
                    { name: 'ÊßìÈà¥Ê∑±Ëπ≤', defaultSets: 4, defaultReps: '6-10' },
                    { name: 'ÁæÖÈ¶¨Â∞º‰∫ûÁ°¨Ëàâ', defaultSets: 4, defaultReps: '8-12' },
                    { name: 'ËÖøÊé®Ê©ü', defaultSets: 3, defaultReps: '10-15' },
                    { name: 'ÂàÜËÖøËπ≤', defaultSets: 3, defaultReps: '10-12' },
                    { name: 'Ê£íÂºè (Plank)', defaultSets: 3, defaultReps: '60s' },
                ]
            },
            {
                id: 'cardio',
                type: 'cardio',
                name: 'ÊúâÊ∞ß (ÁáÉËÑÇ/ÂøÉËÇ∫)',
                exercises: [
                    { name: 'Ë∑ëÊ≠•Ê©ü (Treadmill)', defaultSets: '30', defaultReps: 'mins' },
                    { name: 'Êà∂Â§ñË∑ëÊ≠• (Running)', defaultSets: '5', defaultReps: 'km' },
                    { name: 'È£õËº™/ÂñÆËªä (Cycling)', defaultSets: '45', defaultReps: 'mins' },
                    { name: 'ÊªëÊ≠•Ê©ü (Elliptical)', defaultSets: '30', defaultReps: 'mins' },
                    { name: 'Ë∑≥Áπ© (Jump Rope)', defaultSets: '15', defaultReps: 'mins' },
                    { name: 'HIIT ÈñìÊ≠áÈÅãÂãï', defaultSets: '20', defaultReps: 'mins' },
                ]
            }
        ];

        // --- ÂÖÉ‰ª∂ÔºöÂÑÄË°®Êùø (Dashboard) ---
        const Dashboard = ({ todayInput, setTodayInput, handleLogSubmit, saveMessage, currentWeight, bmi, tdee, recommendedCalories, daysLeft, currentDate, setCurrentDate, recommendedProtein, logs, currentBodyFat, currentMuscleMass, currentVisceralFat, todayStr }) => {
            const todayCalories = todayInput.calories ? parseFloat(todayInput.calories) : 0;
            const caloriePct = Math.min((todayCalories / recommendedCalories) * 100, 100);
            const calorieColor = todayCalories > recommendedCalories ? 'bg-red-500' : 'bg-orange-500';
            const isEditingPast = currentDate !== todayStr;

            return (
                <div className="space-y-6 animate-fade-in">
                    {/* Top Stats Cards - Row 1: Weight & Time */}
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-l-rose-500 border border-slate-100">
                            <p className="text-xs text-slate-500 mb-1 font-semibold tracking-wide uppercase">ÁõÆÂâçÈ´îÈáç / BMI</p>
                            <div className="flex items-baseline gap-2">
                                <p className="text-2xl font-black text-slate-800">{currentWeight}</p>
                                <span className="text-xs px-1.5 py-0.5 rounded bg-slate-100 text-slate-600 font-bold">BMI {bmi}</span>
                            </div>
                        </div>
                        <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-l-orange-500 border border-slate-100">
                            <p className="text-xs text-slate-500 mb-1 font-semibold tracking-wide uppercase">ÊØèÊó•Ê∂àËÄó TDEE</p>
                            <div className="flex items-baseline gap-2">
                                <p className="text-2xl font-black text-orange-600">{tdee}</p>
                                <span className="text-xs text-slate-400 font-bold">kcal</span>
                            </div>
                        </div>
                        <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-l-emerald-500 border border-slate-100">
                            <p className="text-xs text-slate-500 mb-1 font-semibold tracking-wide uppercase">Ê∏õËÑÇÁõÆÊ®ôÁÜ±Èáè</p>
                            <div className="flex items-baseline gap-2">
                                <p className="text-2xl font-black text-emerald-600">{recommendedCalories}</p>
                                <span className="text-xs text-slate-400 font-bold">kcal</span>
                            </div>
                        </div>
                        <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-l-blue-600 border border-slate-100">
                            <p className="text-xs text-slate-500 mb-1 font-semibold tracking-wide uppercase">Ââ©È§òÊà∞È¨•Â§©Êï∏</p>
                            <p className="text-2xl font-black text-blue-700">{daysLeft} <span className="text-sm font-bold text-slate-400">Â§©</span></p>
                        </div>
                    </div>

                    {/* Top Stats Cards - Row 2: Body Composition */}
                    <div className="grid grid-cols-3 gap-4">
                        <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                            <div className="flex items-center gap-2 mb-1">
                                <Activity className="w-4 h-4 text-purple-500" />
                                <p className="text-xs text-slate-500 font-semibold uppercase">È´îËÑÇÁéá</p>
                            </div>
                            <div className="flex items-baseline gap-1">
                                <p className="text-xl font-black text-slate-800">{currentBodyFat || '--'}</p>
                                <span className="text-xs text-slate-400 font-bold">%</span>
                            </div>
                        </div>
                        <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                            <div className="flex items-center gap-2 mb-1">
                                <Dumbbell className="w-4 h-4 text-indigo-500" />
                                <p className="text-xs text-slate-500 font-semibold uppercase">ËÇåËÇâÈáè</p>
                            </div>
                            <div className="flex items-baseline gap-1">
                                <p className="text-xl font-black text-slate-800">{currentMuscleMass || '--'}</p>
                                <span className="text-xs text-slate-400 font-bold">kg</span>
                            </div>
                        </div>
                        <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                            <div className="flex items-center gap-2 mb-1">
                                <Zap className="w-4 h-4 text-red-500" />
                                <p className="text-xs text-slate-500 font-semibold uppercase">ÂÖßËáüËÑÇËÇ™</p>
                            </div>
                            <div className="flex items-baseline gap-1">
                                <p className="text-xl font-black text-slate-800">{currentVisceralFat || '--'}</p>
                                <span className="text-xs text-slate-400 font-bold">Lv</span>
                            </div>
                        </div>
                    </div>

                    {/* Nutrition Progress */}
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h3 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                            <Utensils className="w-5 h-5 text-orange-500" />
                            ‰ªäÊó•ÁáüÈ§äÂÑÄË°®Êùø
                        </h3>
                        <div className="space-y-4">
                            <div>
                                <div className="flex justify-between text-xs font-bold text-slate-600 mb-1">
                                    <span>ÁÜ±ÈáèÊîùÂèñ: {todayCalories} / {recommendedCalories} kcal</span>
                                    <span className={todayCalories > recommendedCalories ? 'text-red-500' : 'text-emerald-500'}>
                                        {todayCalories > recommendedCalories ? 'Â∑≤Ë∂ÖÊ®ô' : 'ÊéßÂà∂‰∏≠'}
                                    </span>
                                </div>
                                <div className="w-full bg-slate-100 rounded-full h-4 overflow-hidden shadow-inner">
                                    <div 
                                        className={`h-4 rounded-full transition-all duration-700 ${calorieColor}`}
                                        style={{ width: `${caloriePct}%` }}
                                    ></div>
                                </div>
                            </div>
                            <div className="flex items-center gap-2 text-xs text-slate-500 bg-slate-50 p-2 rounded">
                                <AlertCircle className="w-4 h-4 text-blue-500" />
                                <span>Âª∫Ë≠∞ËõãÁôΩË≥™ÊîùÂèñ: <strong>{recommendedProtein}g</strong> (È´îÈáç x 2.0g) ‰ª•Á∂≠ÊåÅËÇåËÇâÈáè</span>
                            </div>
                        </div>
                    </div>

                    {/* Charts */}
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h3 className="font-bold text-slate-700 mb-6 flex items-center gap-2">
                            <TrendingDown className="w-5 h-5 text-rose-600" />
                            Êà∞È¨•Êï∏ÊìöÂàÜÊûê
                        </h3>
                        <div className="h-72 w-full">
                            {Recharts && AreaChart ? (
                                <ResponsiveContainer width="100%" height="100%">
                                    <ComposedChart data={logs}>
                                        <defs>
                                            <linearGradient id="colorWeight" x1="0" y1="0" x2="0" y2="1">
                                                <stop offset="5%" stopColor="#e11d48" stopOpacity={0.2}/>
                                                <stop offset="95%" stopColor="#e11d48" stopOpacity={0}/>
                                            </linearGradient>
                                        </defs>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                        <XAxis dataKey="date" tick={{fontSize: 12, fill: '#64748b', fontWeight: 'bold'}} tickMargin={10} />
                                        <YAxis yAxisId="left" domain={['dataMin - 1', 'dataMax + 1']} tick={{fontSize: 12, fill: '#64748b', fontWeight: 'bold'}} />
                                        <YAxis yAxisId="right" orientation="right" domain={[0, 'dataMax + 500']} hide />
                                        <Tooltip 
                                            contentStyle={{borderRadius: '8px', border: 'none', boxShadow: '0 10px 15px -3px rgb(0 0 0 / 0.1)', backgroundColor: '#1e293b', color: '#fff'}}
                                            itemStyle={{color: '#fff'}}
                                            labelStyle={{color: '#94a3b8', marginBottom: '0.5rem'}}
                                        />
                                        <Area 
                                            yAxisId="left"
                                            type="monotone" 
                                            dataKey="weight" 
                                            stroke="#e11d48" 
                                            strokeWidth={4}
                                            fillOpacity={1} 
                                            fill="url(#colorWeight)" 
                                            name="È´îÈáç (kg)"
                                            activeDot={{r: 6, strokeWidth: 0, fill: '#e11d48'}}
                                        />
                                        <Bar 
                                            yAxisId="right"
                                            dataKey="calories" 
                                            barSize={20}
                                            fill="#f59e0b" 
                                            radius={[4, 4, 0, 0]}
                                            name="ÊîùÂèñÁÜ±Èáè (kcal)"
                                            opacity={0.6}
                                        />
                                        <Legend verticalAlign="top" height={36} iconType="circle"/>
                                    </ComposedChart>
                                </ResponsiveContainer>
                            ) : (
                                <div className="w-full h-full flex items-center justify-center text-slate-400 bg-slate-50 rounded-lg border border-dashed border-slate-300">
                                    <p>ÂúñË°®ËºâÂÖ•‰∏≠... (Ëã•Èï∑ÊôÇÈñìÊú™È°ØÁ§∫ÔºåË´ãÊ™¢Êü•Á∂≤Ë∑ØÈÄ£Á∑ö)</p>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Quick Log Input (Body Stats) */}
                    <div className={`bg-gradient-to-br p-6 rounded-xl shadow-xl text-white border border-rose-900/50 relative overflow-hidden transition-all ${isEditingPast ? 'from-orange-900 to-rose-900 ring-2 ring-orange-400' : 'from-slate-900 to-rose-900'}`}>
                        <div className="absolute top-0 right-0 p-8 opacity-10 pointer-events-none">
                            <Flame className="w-32 h-32 text-rose-500" />
                        </div>
                        
                        <div className="flex justify-between items-center mb-4 relative z-10">
                            <h3 className="font-bold text-lg flex items-center gap-2">
                                {isEditingPast ? (
                                    <>
                                        <Edit className="w-5 h-5 text-orange-400" />
                                        <span className="text-orange-200">Á∑®ËºØÁ¥ÄÈåÑ ({currentDate})</span>
                                    </>
                                ) : (
                                    <>
                                        <Plus className="w-5 h-5 text-rose-400" />
                                        ‰ªäÊó•È´îÊÖãÁ¥ÄÈåÑ
                                    </>
                                )}
                            </h3>
                            <div className="flex items-center gap-2">
                                {isEditingPast && (
                                    <button 
                                        onClick={() => setCurrentDate(todayStr)}
                                        className="bg-white/10 hover:bg-white/20 text-white text-xs px-2 py-1 rounded flex items-center gap-1 transition-colors"
                                    >
                                        <RotateCcw className="w-3 h-3" /> Âõû‰ªäÂ§©
                                    </button>
                                )}
                                <div className="flex items-center gap-2 bg-black/20 rounded-lg px-2 py-1 border border-white/10">
                                    <Calendar className="w-4 h-4 text-rose-400" />
                                    <input 
                                        type="date" 
                                        value={currentDate}
                                        onChange={(e) => setCurrentDate(e.target.value)}
                                        className="bg-transparent text-sm text-white font-bold outline-none border-none p-0 w-28 text-right cursor-pointer"
                                    />
                                </div>
                            </div>
                        </div>

                        <form onSubmit={handleLogSubmit} className="grid grid-cols-2 gap-4 relative z-10">
                            <div>
                                <label className="text-xs text-rose-200/70 block mb-1 flex items-center gap-1 font-bold"><Scale className="w-3 h-3"/> È´îÈáç (kg)</label>
                                <input 
                                    type="number" step="0.1" 
                                    value={todayInput.weight}
                                    onChange={(e) => setTodayInput({...todayInput, weight: e.target.value})}
                                    className="w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-rose-500 focus:bg-black/50 transition-all font-bold placeholder-white/20"
                                    placeholder=""
                                />
                            </div>
                            <div>
                                <label className="text-xs text-rose-200/70 block mb-1 flex items-center gap-1 font-bold"><Activity className="w-3 h-3"/> È´îËÑÇ (%)</label>
                                <input 
                                    type="number" step="0.1" 
                                    value={todayInput.bodyFat}
                                    onChange={(e) => setTodayInput({...todayInput, bodyFat: e.target.value})}
                                    className="w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-rose-500 focus:bg-black/50 transition-all font-bold placeholder-white/20"
                                    placeholder=""
                                />
                            </div>
                            {/* New Fields for Body Composition */}
                            <div>
                                <label className="text-xs text-rose-200/70 block mb-1 flex items-center gap-1 font-bold"><Dumbbell className="w-3 h-3"/> ËÇåËÇâÈáè (kg)</label>
                                <input 
                                    type="number" step="0.1" 
                                    value={todayInput.muscleMass}
                                    onChange={(e) => setTodayInput({...todayInput, muscleMass: e.target.value})}
                                    className="w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-rose-500 focus:bg-black/50 transition-all font-bold placeholder-white/20"
                                    placeholder=""
                                />
                            </div>
                            <div>
                                <label className="text-xs text-rose-200/70 block mb-1 flex items-center gap-1 font-bold"><Zap className="w-3 h-3"/> ÂÖßËáüËÑÇËÇ™ (Lv)</label>
                                <input 
                                    type="number" step="0.5" 
                                    value={todayInput.visceralFat}
                                    onChange={(e) => setTodayInput({...todayInput, visceralFat: e.target.value})}
                                    className="w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-rose-500 focus:bg-black/50 transition-all font-bold placeholder-white/20"
                                    placeholder=""
                                />
                            </div>

                            <button type="submit" className="col-span-2 bg-rose-600 hover:bg-rose-500 text-white p-3 rounded-lg transition-colors font-black mt-2 flex justify-center items-center gap-2 shadow-lg shadow-rose-900/50 uppercase tracking-widest text-sm transform active:scale-95 duration-100">
                                <Save className="w-4 h-4" /> {isEditingPast ? `Êõ¥Êñ∞Á¥ÄÈåÑ (${currentDate})` : 'ÂÑ≤Â≠òÁ¥ÄÈåÑ'}
                            </button>
                            {saveMessage && (
                                <div className="col-span-2 text-center text-emerald-400 text-sm font-bold animate-pulse">
                                    {saveMessage}
                                </div>
                            )}
                        </form>
                    </div>
                </div>
            );
        };

        // --- ÂÖÉ‰ª∂ÔºöÈ£≤È£ü (DietSection) ---
        const DietSection = ({ todayInput, setTodayInput, handleLogSubmit, saveMessage, recommendedCalories, recommendedProtein, currentDate, setCurrentDate, todayStr }) => {
            const isEditingPast = currentDate !== todayStr;

            const handleAddFood = (e) => {
                const selectedValue = e.target.value;
                if (!selectedValue) return;

                let foundFood = null;
                for (const cat of COMMON_FOODS) {
                    const item = cat.items.find(i => i.name === selectedValue);
                    if (item) {
                        foundFood = item;
                        break;
                    }
                }

                if (foundFood) {
                    setTodayInput(prev => {
                        const currentCal = parseFloat(prev.calories) || 0;
                        const currentPro = parseFloat(prev.protein) || 0;
                        const currentNotes = prev.notes || "";
                        
                        return {
                            ...prev,
                            calories: (currentCal + foundFood.cal).toString(),
                            protein: (currentPro + foundFood.pro).toString(),
                            notes: currentNotes ? `${currentNotes} +${foundFood.name}` : `+${foundFood.name}`
                        };
                    });
                }
                
                e.target.value = "";
            };

            const todayCalories = todayInput.calories ? parseFloat(todayInput.calories) : 0;
            const caloriePct = Math.min((todayCalories / recommendedCalories) * 100, 100);
            const calorieColor = todayCalories > recommendedCalories ? 'bg-red-500' : 'bg-emerald-500';

            return (
                <div className="space-y-6 animate-fade-in pb-20">
                    <div className="flex justify-between items-center">
                        <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                            <Utensils className="w-6 h-6 text-orange-500" />
                            È£≤È£üÊéßÂà∂
                        </h2>
                        <div className="flex items-center gap-2 bg-white rounded-lg px-3 py-1 border border-slate-200 shadow-sm">
                            <Calendar className="w-4 h-4 text-slate-500" />
                            <input 
                                type="date" 
                                value={currentDate}
                                onChange={(e) => setCurrentDate(e.target.value)}
                                className="bg-transparent text-sm text-slate-600 font-bold outline-none border-none p-0 w-28 text-right cursor-pointer"
                            />
                        </div>
                    </div>

                    {/* Status Card */}
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <div className="flex justify-between text-sm font-bold text-slate-600 mb-2">
                            <span>‰ªäÊó•ÁÜ±ÈáèÊîùÂèñ</span>
                            <span className={todayCalories > recommendedCalories ? 'text-red-500' : 'text-emerald-500'}>
                                {todayCalories} / {recommendedCalories} kcal
                            </span>
                        </div>
                        <div className="w-full bg-slate-100 rounded-full h-4 overflow-hidden shadow-inner mb-4">
                            <div 
                                className={`h-4 rounded-full transition-all duration-700 ${calorieColor}`}
                                style={{ width: `${caloriePct}%` }}
                            ></div>
                        </div>
                        <div className="flex gap-2">
                             <div className="flex-1 bg-orange-50 p-3 rounded-lg text-center">
                                 <p className="text-xs text-orange-400 font-bold">ËõãÁôΩË≥™</p>
                                 <p className="text-xl font-black text-orange-600">{todayInput.protein || 0}<span className="text-xs text-orange-400">g</span></p>
                                 <p className="text-[10px] text-orange-300">ÁõÆÊ®ô: {recommendedProtein}g</p>
                             </div>
                             <div className="flex-1 bg-blue-50 p-3 rounded-lg text-center">
                                 <p className="text-xs text-blue-400 font-bold">Ââ©È§òÁÜ±Èáè</p>
                                 <p className={`text-xl font-black ${recommendedCalories - todayCalories < 0 ? 'text-red-500' : 'text-blue-600'}`}>
                                     {recommendedCalories - todayCalories}
                                 </p>
                                 <p className="text-[10px] text-blue-300">kcal</p>
                             </div>
                        </div>
                    </div>

                    {/* Food Logger */}
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h3 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                            <PlusCircle className="w-5 h-5 text-orange-500" />
                            Êñ∞Â¢ûÈ£≤È£ü
                        </h3>

                        {/* Food Selector */}
                        <div className="mb-6 relative">
                            <label className="block text-xs font-bold text-slate-400 mb-1">Âø´ÈÄüÈÅ∏ÂñÆ (Ëá™ÂãïÁ¥ØÂä†)</label>
                            <div className="relative">
                                <select 
                                    onChange={handleAddFood} 
                                    defaultValue=""
                                    className="w-full bg-slate-50 border border-slate-200 rounded-lg pl-3 pr-8 py-3 text-slate-700 text-sm font-medium focus:outline-none focus:border-orange-500 appearance-none cursor-pointer hover:bg-slate-100 transition-colors"
                                >
                                    <option value="" disabled>üçî ÈªûÊ≠§ÈÅ∏ÊìáÈ£üÁâ©...</option>
                                    {COMMON_FOODS.map((cat, idx) => (
                                        <optgroup key={idx} label={cat.category}>
                                            {cat.items.map((item, i) => (
                                                <option key={i} value={item.name}>
                                                    {item.name} ({item.cal}Â§ßÂç°)
                                                </option>
                                            ))}
                                        </optgroup>
                                    ))}
                                </select>
                                <div className="absolute right-3 top-3.5 pointer-events-none text-slate-400">
                                    <PlusCircle className="w-4 h-4" />
                                </div>
                            </div>
                        </div>

                        {/* Manual Input */}
                        <form onSubmit={handleLogSubmit} className="space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="text-xs text-slate-500 block mb-1 font-bold">Á∏ΩÁÜ±Èáè (kcal)</label>
                                    <input 
                                        type="number"
                                        value={todayInput.calories}
                                        onChange={(e) => setTodayInput({...todayInput, calories: e.target.value})}
                                        className="w-full border border-slate-200 rounded-lg p-2.5 focus:ring-2 focus:ring-orange-500 outline-none font-bold text-slate-700 bg-slate-50"
                                        placeholder="0"
                                    />
                                </div>
                                <div>
                                    <label className="text-xs text-slate-500 block mb-1 font-bold">Á∏ΩËõãÁôΩË≥™ (g)</label>
                                    <input 
                                        type="number"
                                        value={todayInput.protein}
                                        onChange={(e) => setTodayInput({...todayInput, protein: e.target.value})}
                                        className="w-full border border-slate-200 rounded-lg p-2.5 focus:ring-2 focus:ring-orange-500 outline-none font-bold text-slate-700 bg-slate-50"
                                        placeholder="0"
                                    />
                                </div>
                            </div>
                            
                            <div>
                                <label className="text-xs text-slate-500 block mb-1 font-bold">È£≤È£üÁ≠ÜË®ò / Êà∞È¨•Êó•Ë®ò</label>
                                <textarea 
                                    value={todayInput.notes}
                                    onChange={(e) => setTodayInput({...todayInput, notes: e.target.value})}
                                    className="w-full border border-slate-200 rounded-lg p-3 text-slate-700 focus:ring-2 focus:ring-orange-500 outline-none bg-slate-50 text-sm h-32 resize-none"
                                    placeholder="Á¥ÄÈåÑ‰ªäÂ§©ÂêÉ‰∫Ü‰ªÄÈ∫º..."
                                />
                            </div>

                            <button type="submit" className="w-full bg-orange-500 hover:bg-orange-600 text-white p-3 rounded-lg transition-colors font-bold flex justify-center items-center gap-2 shadow-lg shadow-orange-200">
                                <Save className="w-4 h-4" /> {isEditingPast ? 'Êõ¥Êñ∞È£≤È£üÁ¥ÄÈåÑ' : 'ÂÑ≤Â≠òÈ£≤È£üÁ¥ÄÈåÑ'}
                            </button>
                            
                            {saveMessage && (
                                <div className="text-center text-emerald-500 text-sm font-bold animate-pulse">
                                    {saveMessage}
                                </div>
                            )}
                        </form>
                    </div>
                </div>
            );
        };

        const WorkoutSection = ({ selectedPlanId, setSelectedPlanId, workoutLogs, updateExerciseLog, toggleExerciseCompletion, currentDate, setCurrentDate }) => {
            const activePlan = DEFAULT_WORKOUTS.find(p => p.id === selectedPlanId);
            const isCardio = activePlan.type === 'cardio';
            
            return (
                <div className="space-y-4 animate-fade-in pb-20">
                    <div className="flex justify-between items-center">
                        <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                            <Dumbbell className="w-6 h-6 text-rose-600" />
                            ‰ªäÊó•ËèúÂñÆ
                        </h2>
                        <div className="flex items-center gap-2 bg-white rounded-lg px-3 py-1 border border-slate-200 shadow-sm">
                            <Calendar className="w-4 h-4 text-slate-500" />
                            <input 
                                type="date" 
                                value={currentDate}
                                onChange={(e) => setCurrentDate(e.target.value)}
                                className="bg-transparent text-sm text-slate-600 font-bold outline-none border-none p-0 w-28 text-right cursor-pointer"
                            />
                        </div>
                    </div>
                
                    {/* Menu Selection */}
                    <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                        {DEFAULT_WORKOUTS.map(plan => (
                            <button
                                key={plan.id}
                                onClick={() => setSelectedPlanId(plan.id)}
                                className={`px-5 py-2.5 rounded-lg whitespace-nowrap text-sm font-bold transition-all shadow-sm border transform active:scale-95 duration-100 ${
                                    selectedPlanId === plan.id 
                                    ? 'bg-rose-600 text-white border-rose-600 shadow-rose-200' 
                                    : 'bg-white text-slate-600 border-slate-200 hover:bg-slate-50'
                                }`}
                            >
                                {plan.name}
                            </button>
                        ))}
                    </div>

                    {/* Exercise List */}
                    <div className="space-y-3">
                        {activePlan.exercises.map((ex, idx) => {
                            const logData = workoutLogs[currentDate]?.[selectedPlanId]?.[idx] || {};
                            const isDone = logData.completed;

                            return (
                                <div key={idx} className={`bg-white rounded-xl shadow-sm border-l-4 transition-all ${isDone ? 'border-l-rose-500 border-rose-100 bg-rose-50/20' : 'border-l-slate-200 border-slate-100'}`}>
                                    {/* Header Row */}
                                    <div className="p-4 flex items-start justify-between">
                                        <div className="flex items-center gap-3">
                                            <button 
                                                onClick={() => toggleExerciseCompletion(selectedPlanId, idx)}
                                                className={`transition-colors transform active:scale-90 duration-100 ${isDone ? 'text-rose-500' : 'text-slate-300 hover:text-rose-300'}`}
                                            >
                                                {isDone ? <CheckCircle2 className="w-6 h-6 fill-rose-100" /> : <Circle className="w-6 h-6" />}
                                            </button>
                                            <div>
                                                <h4 className={`font-bold ${isDone ? 'text-rose-900 line-through decoration-rose-400' : 'text-slate-800'}`}>{ex.name}</h4>
                                                <p className="text-xs font-medium text-slate-500 bg-slate-100 inline-block px-1.5 py-0.5 rounded mt-1">
                                                    ÁõÆÊ®ô: {ex.defaultSets} {isCardio ? '' : 'ÁµÑ'} {isCardio ? '' : 'x'} {ex.defaultReps}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* Input Row */}
                                    <div className="px-4 pb-4 pl-12 flex gap-3">
                                        {/* Field 1: Weight or Duration */}
                                        <div className="flex-1 relative group">
                                            <input 
                                                type="number" 
                                                placeholder=""
                                                value={isCardio ? (logData.duration || '') : (logData.weight || '')}
                                                onChange={(e) => updateExerciseLog(selectedPlanId, idx, isCardio ? 'duration' : 'weight', e.target.value)}
                                                className="w-full bg-slate-50 border border-slate-200 rounded-lg py-2 pl-3 pr-8 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-rose-500 focus:bg-white outline-none transition-all"
                                            />
                                            <span className="absolute right-3 top-2 text-xs text-slate-400 font-bold group-focus-within:text-rose-500 pointer-events-none flex items-center gap-1">
                                                {isCardio ? <Timer className="w-3 h-3"/> : <Scale className="w-3 h-3"/>}
                                                {isCardio ? 'min' : 'kg'}
                                            </span>
                                        </div>
                                        
                                        {/* Field 2: Reps or Distance */}
                                        <div className="flex-1 relative group">
                                            <input 
                                                type="number" 
                                                placeholder=""
                                                value={isCardio ? (logData.distance || '') : (logData.reps || '')}
                                                onChange={(e) => updateExerciseLog(selectedPlanId, idx, isCardio ? 'distance' : 'reps', e.target.value)}
                                                className="w-full bg-slate-50 border border-slate-200 rounded-lg py-2 pl-3 pr-8 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-rose-500 focus:bg-white outline-none transition-all"
                                            />
                                            <span className="absolute right-3 top-2 text-xs text-slate-400 font-bold group-focus-within:text-rose-500 pointer-events-none flex items-center gap-1">
                                                {isCardio ? <Footprints className="w-3 h-3"/> : <Dumbbell className="w-3 h-3"/>}
                                                {isCardio ? 'km' : 'reps'}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    <div className="bg-slate-900 p-4 rounded-lg text-sm text-slate-300 flex gap-3 items-start border border-slate-800 shadow-lg">
                        <div className="mt-0.5 p-1 bg-rose-600 rounded text-white"><Dumbbell className="w-3 h-3"/></div>
                        <div>
                            <p className="font-bold text-white mb-1">
                                {isCardio ? 'üî• ÊúâÊ∞ßÂ∞èÁü•Ë≠ò (Cardio Tips)' : 'üí™ Êº∏ÈÄ≤ÂºèË≤†Ëç∑ (Progressive Overload)'}
                            </p>
                            <p className="opacity-80 text-xs leading-relaxed">
                                {isCardio 
                                    ? 'ÊúâÊ∞ßÈÅãÂãïËÉΩÊúâÊïàÊèêÂçáÂøÉËÇ∫ÂäüËÉΩ‰∏¶ËºîÂä©ÁáÉËÑÇ„ÄÇÂª∫Ë≠∞ÊØèÈÄ±ÈÄ≤Ë°å 150 ÂàÜÈêò‰∏≠Á≠âÂº∑Â∫¶ÊúâÊ∞ß„ÄÇË®òÂæóÂú®ÈáçË®ìÂæåÈÄ≤Ë°åÊúâÊ∞ßÊïàÊûúÊõ¥‰Ω≥ÔºÅ' 
                                    : 'Á¥ÄÈåÑÊØè‰∏ÄÊ¨°ÁöÑÈáçÈáèËàáÊ¨°Êï∏„ÄÇÂè™Ë¶ÅÊØî‰∏äÊ¨°Â§öËàâ 1kg ÊàñÂ§öÂÅö 1‰∏ãÔºå‰Ω†Â∞±Âú®ËÆäÂº∑ÔºÅ'}
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        const HistorySection = ({ logs, deleteLog, editLog }) => {
            return (
                <div className="animate-fade-in pb-20">
                    <h2 className="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <History className="w-6 h-6 text-rose-600" />
                        Êà∞È¨•Ê≠∑Á®ã
                    </h2>
                    <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm text-left">
                                <thead className="bg-slate-50 text-slate-600 font-bold border-b border-slate-200 uppercase tracking-wider text-xs">
                                    <tr>
                                        <th className="p-4 whitespace-nowrap">Êó•Êúü</th>
                                        <th className="p-4 whitespace-nowrap">È´îÊÖãÊï∏Êìö</th>
                                        <th className="p-4 whitespace-nowrap">È£≤È£üÊï∏Êìö</th>
                                        <th className="p-4 text-right">Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                    {[...logs].reverse().map((log, idx) => (
                                        <tr key={idx} className="hover:bg-rose-50/30 transition-colors">
                                            <td className="p-4 font-bold text-slate-700 whitespace-nowrap align-top">
                                                {log.date}
                                                {log.notes && (
                                                    <div className="mt-1 text-xs text-slate-400 font-normal flex gap-1 max-w-[150px] truncate">
                                                        <FileText className="w-3 h-3 min-w-[12px]" />
                                                        {log.notes}
                                                    </div>
                                                )}
                                            </td>
                                            <td className="p-4 align-top">
                                                <div className="font-bold text-slate-800">{log.weight} kg</div>
                                                <div className="text-xs font-medium text-slate-500">
                                                    {log.bodyFat ? `È´îËÑÇ ${log.bodyFat}%` : ''} 
                                                    {log.muscleMass ? ` / ËÇåËÇâ ${log.muscleMass}kg` : ''}
                                                </div>
                                            </td>
                                            <td className="p-4 align-top">
                                                <div className="text-orange-600 font-bold">{log.calories ? `${log.calories} kcal` : '-'}</div>
                                                <div className="text-xs font-medium text-slate-500">{log.protein ? `${log.protein}g P` : '-'}</div>
                                            </td>
                                            <td className="p-4 text-right align-top">
                                                <div className="flex justify-end gap-2">
                                                    <button 
                                                        onClick={() => editLog(log.date)}
                                                        className="bg-blue-600 hover:bg-blue-700 text-white transition-colors px-3 py-1.5 rounded-lg flex items-center gap-1 font-bold text-xs shadow-sm"
                                                    >
                                                        <Edit className="w-3.5 h-3.5" /> ‰øÆÊîπ
                                                    </button>
                                                    <button 
                                                        onClick={() => deleteLog(log.date)}
                                                        className="text-rose-400 hover:text-rose-600 transition-colors p-1.5 hover:bg-rose-50 rounded-lg"
                                                    >
                                                        <Trash2 className="w-4 h-4" />
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                    {logs.length === 0 && (
                                        <tr>
                                            <td colSpan="4" className="p-8 text-center text-slate-400 font-medium">
                                                Â∞öÁÑ°Á¥ÄÈåÑÔºå‰ªäÂ§©Â∞±ÊòØÊîπËÆäÁöÑÈñãÂßãÔºÅ
                                            </td>
                                        </tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };

        const SettingsSection = ({ userProfile, setUserProfile }) => {
            return (
                <div className="animate-fade-in pb-20">
                    <h2 className="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <Settings className="w-6 h-6 text-rose-600" />
                        ÂÄã‰∫∫Ê™îÊ°àËàáÁõÆÊ®ô
                    </h2>
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 space-y-6">
                        {/* Personal Details */}
                        <div className="space-y-4">
                            <h3 className="text-sm font-black text-slate-800 uppercase tracking-wider border-b border-slate-100 pb-2 flex items-center gap-2">
                                <Activity className="w-4 h-4 text-slate-400" />
                                Âü∫Êú¨Ë≥áÊñô (Áî®ÊñºË®àÁÆó‰ª£Ë¨ù)
                            </h3>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 mb-1">Ë∫´È´ò (cm)</label>
                                    <input 
                                        type="number" 
                                        value={userProfile.height}
                                        onChange={(e) => setUserProfile({...userProfile, height: parseFloat(e.target.value)})}
                                        className="w-full border border-slate-200 rounded-lg p-2.5 focus:ring-2 focus:ring-rose-500 outline-none font-medium"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 mb-1">Âπ¥ÈΩ°</label>
                                    <input 
                                        type="number" 
                                        value={userProfile.age}
                                        onChange={(e) => setUserProfile({...userProfile, age: parseFloat(e.target.value)})}
                                        className="w-full border border-slate-200 rounded-lg p-2.5 focus:ring-2 focus:ring-rose-500 outline-none font-medium"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 mb-1">ÊÄßÂà•</label>
                                    <select 
                                        value={userProfile.gender}
                                        onChange={(e) => setUserProfile({...userProfile, gender: e.target.value})}
                                        className="w-full border border-slate-200 rounded-lg p-2.5 focus:ring-2 focus:ring-rose-500 outline-none bg-white font-medium"
                                    >
                                        <option value="male">Áî∑</option>
                                        <option value="female">Â•≥</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 mb-1">Êó•Â∏∏Ê¥ªÂãïÈáè</label>
                                    <select 
                                        value={userProfile.activityLevel}
                                        onChange={(e) => setUserProfile({...userProfile, activityLevel: parseFloat(e.target.value)})}
                                        className="w-full border border-slate-200 rounded-lg p-2.5 focus:ring-2 focus:ring-rose-500 outline-none bg-white text-sm font-medium"
                                    >
                                        <option value="1.2">‰πÖÂùê (Ê≤íÈÅãÂãï)</option>
                                        <option value="1.375">ËºïÂ∫¶ (ÊØèÈÄ±1-3Ê¨°)</option>
                                        <option value="1.55">‰∏≠Â∫¶ (ÊØèÈÄ±3-5Ê¨°)</option>
                                        <option value="1.725">È´òÂ∫¶ (ÊØèÈÄ±6-7Ê¨°)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        {/* Targets */}
                        <div className="space-y-4 pt-2">
                            <h3 className="text-sm font-black text-slate-800 uppercase tracking-wider border-b border-slate-100 pb-2 flex items-center gap-2">
                                <Trophy className="w-4 h-4 text-slate-400" />
                                Ê∏õÈáçÁõÆÊ®ô
                            </h3>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 mb-1">Ëµ∑ÂßãÈ´îÈáç (kg)</label>
                                    <input 
                                        type="number" 
                                        value={userProfile.startWeight}
                                        onChange={(e) => setUserProfile({...userProfile, startWeight: parseFloat(e.target.value)})}
                                        className="w-full border border-slate-200 rounded-lg p-2.5 focus:ring-2 focus:ring-rose-500 outline-none font-medium"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 mb-1">ÁõÆÊ®ôÈ´îÈáç (kg)</label>
                                    <input 
                                        type="number" 
                                        value={userProfile.targetWeight}
                                        onChange={(e) => setUserProfile({...userProfile, targetWeight: parseFloat(e.target.value)})}
                                        className="w-full border border-slate-200 rounded-lg p-2.5 focus:ring-2 focus:ring-rose-500 outline-none font-medium"
                                    />
                                </div>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-500 mb-1">ÁõÆÊ®ôÈÅîÊàêÊó•Êúü</label>
                                <input 
                                    type="date" 
                                    value={userProfile.targetDate}
                                    onChange={(e) => setUserProfile({...userProfile, targetDate: e.target.value})}
                                    className="w-full border border-slate-200 rounded-lg p-2.5 focus:ring-2 focus:ring-rose-500 outline-none font-medium"
                                />
                            </div>
                        </div>

                        <div className="pt-4 border-t border-slate-100 bg-slate-50 p-4 rounded text-xs text-slate-500 leading-relaxed">
                            * Á≥ªÁµ±ÊúÉÊ†πÊìö‰Ω†ÁöÑË∫´È´ò„ÄÅÈ´îÈáç„ÄÅÂπ¥ÈΩ°ËàáÊ¥ªÂãïÈáèËá™ÂãïË®àÁÆó TDEE ËàáÂª∫Ë≠∞ÁÜ±Èáè„ÄÇ
                            <br/>
                            * Ë≥áÊñôÂÉÖÂÑ≤Â≠òÊñºÊ≠§Ë£ùÁΩÆÁÄèË¶ΩÂô®‰∏≠ (LocalStorage)„ÄÇ
                        </div>
                    </div>
                </div>
            );
        };

        function FitTrackApp() {
            const [activeTab, setActiveTab] = useState('dashboard');
            
            const getStoredItem = (key, defaultValue) => {
                try {
                    const saved = localStorage.getItem(key);
                    return saved ? JSON.parse(saved) : defaultValue;
                } catch (e) {
                    console.warn('LocalStorage access failed:', e);
                    return defaultValue;
                }
            };

            const setStoredItem = (key, value) => {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                } catch (e) {
                    console.warn('LocalStorage write failed:', e);
                }
            };

            const [userProfile, setUserProfile] = useState(() => getStoredItem('fitTrack_profile', {
                startWeight: 60,
                targetWeight: 55,
                targetDate: '2026-12-31',
                height: 175,
                age: 30,
                gender: 'male',
                activityLevel: 1.375,
            }));

            const [logs, setLogs] = useState(() => getStoredItem('fitTrack_logs', [
                { date: '2026-01-01', weight: 60, bodyFat: 25, muscleMass: 35, visceralFat: 8, calories: 2500, protein: 120, notes: 'Êñ∞Âπ¥Êñ∞Â∏åÊúõÔºåÈñãÂßãÊ∏õËÑÇÔºÅ' },
            ]));

            const [workoutLogs, setWorkoutLogs] = useState(() => getStoredItem('fitTrack_workouts_v2', {}));

            // ‰ΩøÁî®Êú¨Âú∞ÊôÇÈñì (Taiwan/Asia) ‰æÜÂàùÂßãÂåñ "‰ªäÂ§©"ÔºåÈÅøÂÖçÊôÇÂçÄÂïèÈ°åÂ∞éËá¥Êó•ÊúüË∑≥ÂõûÊò®Â§©
            const getTodayStr = () => {
                const now = new Date();
                // Á∞°ÂñÆËôïÁêÜÔºöÁî®Êú¨Âú∞ÊôÇÈñìÁöÑ YYYY-MM-DD
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            const todayStr = useMemo(() => getTodayStr(), []);
            const [currentDate, setCurrentDate] = useState(todayStr);
            
            const [todayInput, setTodayInput] = useState({
                weight: '',
                bodyFat: '',
                muscleMass: '',
                visceralFat: '',
                calories: '',
                protein: '',
                notes: ''
            });

            useEffect(() => {
                const existingLog = logs.find(l => l.date === currentDate);
                if (existingLog) {
                    setTodayInput({
                        weight: existingLog.weight || '',
                        bodyFat: existingLog.bodyFat || '',
                        muscleMass: existingLog.muscleMass || '',
                        visceralFat: existingLog.visceralFat || '',
                        calories: existingLog.calories || '',
                        protein: existingLog.protein || '',
                        notes: existingLog.notes || ''
                    });
                } else {
                    // Reset inputs if no data for selected date
                    setTodayInput({
                        weight: '',
                        bodyFat: '',
                        muscleMass: '',
                        visceralFat: '',
                        calories: '',
                        protein: '',
                        notes: ''
                    });
                }
            }, [logs, currentDate]);

            const [selectedPlanId, setSelectedPlanId] = useState('push');
            const [saveMessage, setSaveMessage] = useState('');

            useEffect(() => {
                setStoredItem('fitTrack_profile', userProfile);
            }, [userProfile]);

            useEffect(() => {
                setStoredItem('fitTrack_logs', logs);
            }, [logs]);

            useEffect(() => {
                setStoredItem('fitTrack_workouts_v2', workoutLogs);
            }, [workoutLogs]);

            // --- Ê†∏ÂøÉÈÇèËºØÊõ¥Êñ∞ÔºöÊ†πÊìöÈÅ∏ÊìáÁöÑÊó•ÊúüË®àÁÆóÁï∂‰∏ãÊáâÈ°ØÁ§∫ÁöÑÊï∏Êìö ---
            const getEffectiveStat = (field, fallback = 0) => {
                // 1. Â¶ÇÊûú‰ΩøÁî®ËÄÖÊ≠£Âú®Ëº∏ÂÖ•ÔºåÂÑ™ÂÖàÈ°ØÁ§∫Ëº∏ÂÖ•‰∏≠ÁöÑÊï∏ÂÄº (Live Preview)
                if (todayInput[field] && todayInput[field] !== '') {
                    const val = parseFloat(todayInput[field]);
                    if (!isNaN(val)) return val;
                }
                
                // 2. Âê¶ÂâáÔºåÊâæÂá∫„ÄåÂ∞èÊñºÁ≠âÊñºÁõÆÂâçÈÅ∏ÊìáÊó•Êúü„ÄçÁöÑÊúÄÊñ∞‰∏ÄÁ≠ÜÁ¥ÄÈåÑ
                const validLogs = logs.filter(l => l.date <= currentDate && l[field] !== undefined && l[field] !== null && l[field] !== '');
                
                if (validLogs.length > 0) {
                    return validLogs[validLogs.length - 1][field];
                }

                // 3. ÈÉΩÊ≤íÊúâÂâáÂõûÂÇ≥È†êË®≠ÂÄº
                return fallback;
            };

            const currentWeight = useMemo(() => getEffectiveStat('weight', userProfile.startWeight), [todayInput.weight, logs, currentDate, userProfile.startWeight]);
            const currentBodyFat = useMemo(() => getEffectiveStat('bodyFat', 0), [todayInput.bodyFat, logs, currentDate]);
            const currentMuscleMass = useMemo(() => getEffectiveStat('muscleMass', 0), [todayInput.muscleMass, logs, currentDate]);
            const currentVisceralFat = useMemo(() => getEffectiveStat('visceralFat', 0), [todayInput.visceralFat, logs, currentDate]);
            
            const bmi = (currentWeight / Math.pow(userProfile.height / 100, 2)).toFixed(1);
            
            const calculateTDEE = () => {
                let bmr = 10 * currentWeight + 6.25 * userProfile.height - 5 * userProfile.age;
                bmr += userProfile.gender === 'male' ? 5 : -161;
                return Math.round(bmr * userProfile.activityLevel);
            };
            const tdee = calculateTDEE();
            const recommendedCalories = Math.round(tdee * 0.85); // 15% Deficit
            const recommendedProtein = Math.round(currentWeight * 2.0); // High protein for cutting

            const daysLeft = useMemo(() => {
                const target = new Date(userProfile.targetDate);
                const today = new Date();
                const diffTime = target - today;
                if (diffTime < 0) return 0;
                return Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            }, [userProfile.targetDate]);

            const handleLogSubmit = (e) => {
                e.preventDefault();
                if (!todayInput.weight && activeTab === 'dashboard') return;
                
                // Á¢∫‰øùÊï∏ÂÄºÊòØÂ≠ó‰∏≤Ôºå‰ª•‰æøÂÑ≤Â≠ò
                const newLog = {
                    date: currentDate,
                    weight: todayInput.weight ? parseFloat(todayInput.weight) : (activeTab === 'dashboard' ? '' : undefined),
                    bodyFat: todayInput.bodyFat ? parseFloat(todayInput.bodyFat) : null,
                    muscleMass: todayInput.muscleMass ? parseFloat(todayInput.muscleMass) : null,
                    visceralFat: todayInput.visceralFat ? parseFloat(todayInput.visceralFat) : null,
                    calories: todayInput.calories ? parseFloat(todayInput.calories) : null,
                    protein: todayInput.protein ? parseFloat(todayInput.protein) : null,
                    notes: todayInput.notes
                };

                // Âêà‰ΩµÁèæÊúâË≥áÊñôÔºàÈÅøÂÖçÂú®‰∏çÂêåÈ†ÅÈù¢ÂÑ≤Â≠òÊôÇË¶ÜËìãÊéâÂè¶‰∏ÄÈ†ÅÁöÑË≥áÊñôÔºâ
                const existingIndex = logs.findIndex(l => l.date === currentDate);
                let newLogs;
                
                if (existingIndex >= 0) {
                    newLogs = [...logs];
                    // Âè™Êõ¥Êñ∞ÊúâÂÄºÁöÑÊ¨Ñ‰ΩçÔºå‰øùÁïôÂéüÊúâÁöÑ
                    const currentLog = newLogs[existingIndex];
                    newLogs[existingIndex] = {
                        ...currentLog,
                        ...Object.fromEntries(Object.entries(newLog).filter(([_, v]) => v !== undefined && v !== null && v !== ''))
                    };
                    
                    // ÁâπÊÆäËôïÁêÜÔºöÂ¶ÇÊûúÊòØÂú® Dashboard ÂÑ≤Â≠òÔºå‰∏îËº∏ÂÖ•Ê°ÜË¢´Ê∏ÖÁ©∫ÔºåÂâáË¶ñÁÇ∫Âà™Èô§Ë©≤Ê¨Ñ‰Ωç? 
                    // Á∞°ÂåñÈÇèËºØÔºöÁõ¥Êé•Ë¶ÜËìãÊúâËº∏ÂÖ•ÁöÑÈÉ®ÂàÜ„ÄÇ
                    if (activeTab === 'diet') {
                        newLogs[existingIndex].calories = newLog.calories || currentLog.calories;
                        newLogs[existingIndex].protein = newLog.protein || currentLog.protein;
                        newLogs[existingIndex].notes = newLog.notes || currentLog.notes;
                    } else if (activeTab === 'dashboard') {
                        newLogs[existingIndex].weight = newLog.weight;
                        newLogs[existingIndex].bodyFat = newLog.bodyFat;
                        newLogs[existingIndex].muscleMass = newLog.muscleMass;
                        newLogs[existingIndex].visceralFat = newLog.visceralFat;
                    }
                } else {
                    newLogs = [...logs, newLog];
                    newLogs.sort((a, b) => new Date(a.date) - new Date(b.date));
                }
                
                setLogs(newLogs);
                setSaveMessage('Á¥ÄÈåÑÂ∑≤Êõ¥Êñ∞ÔºÅKeep Grinding!');
                setTimeout(() => setSaveMessage(''), 3000);
            };

            const handleEditLog = (date) => {
                setCurrentDate(date);
                setActiveTab('dashboard');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const updateExerciseLog = (planId, exerciseIndex, field, value) => {
                const currentDayLogs = workoutLogs[currentDate] || {};
                const currentPlanLogs = currentDayLogs[planId] || {};
                const currentExerciseLog = currentPlanLogs[exerciseIndex] || { completed: false };

                const updatedExerciseLog = { ...currentExerciseLog, [field]: value };
                
                if (value !== '') {
                    updatedExerciseLog.completed = true;
                }

                setWorkoutLogs({
                    ...workoutLogs,
                    [currentDate]: {
                        ...currentDayLogs,
                        [planId]: {
                            ...currentPlanLogs,
                            [exerciseIndex]: updatedExerciseLog
                        }
                    }
                });
            };

            const toggleExerciseCompletion = (planId, exerciseIndex) => {
                const currentStatus = workoutLogs[currentDate]?.[planId]?.[exerciseIndex]?.completed || false;
                updateExerciseLog(planId, exerciseIndex, 'completed', !currentStatus);
            };

            const deleteLog = (date) => {
                if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÁ≠ÜÁ¥ÄÈåÑÂóéÔºü')) {
                    setLogs(logs.filter(l => l.date !== date));
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900 pb-24 md:pb-0">
                    
                    {/* Header */}
                    <header className="bg-gradient-to-r from-rose-700 to-orange-600 shadow-lg sticky top-0 z-30">
                        <div className="max-w-3xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className="bg-white/20 p-2 rounded-lg backdrop-blur-sm">
                                    <Scale className="w-5 h-5 text-white" />
                                </div>
                                <div>
                                    <h1 className="text-xl font-black text-white leading-tight italic tracking-wide">
                                    FitTrack 2026
                                    </h1>
                                    <p className="text-[10px] text-rose-100 font-bold tracking-widest opacity-80">BE STRONGER</p>
                                </div>
                            </div>
                            <div className="text-right text-white">
                                <div className="text-xs font-bold opacity-90">
                                    {new Date().toLocaleDateString('zh-TW', { month: 'long', day: 'numeric' })}
                                </div>
                                <div className="text-[10px] opacity-70">
                                    {new Date().toLocaleDateString('zh-TW', { weekday: 'long' })}
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content Area */}
                    <main className="max-w-3xl mx-auto px-4 py-6">
                        {activeTab === 'dashboard' && (
                            <Dashboard 
                                todayInput={todayInput} 
                                setTodayInput={setTodayInput}
                                handleLogSubmit={handleLogSubmit}
                                saveMessage={saveMessage}
                                currentWeight={currentWeight}
                                bmi={bmi}
                                tdee={tdee}
                                recommendedCalories={recommendedCalories}
                                daysLeft={daysLeft}
                                currentDate={currentDate} // Pass for input value
                                setCurrentDate={setCurrentDate} // Pass setter
                                recommendedProtein={recommendedProtein}
                                logs={logs}
                                currentBodyFat={currentBodyFat}
                                currentMuscleMass={currentMuscleMass}
                                currentVisceralFat={currentVisceralFat}
                                todayStr={todayStr}
                            />
                        )}
                        {activeTab === 'diet' && (
                            <DietSection 
                                todayInput={todayInput} 
                                setTodayInput={setTodayInput}
                                handleLogSubmit={handleLogSubmit}
                                saveMessage={saveMessage}
                                recommendedCalories={recommendedCalories}
                                recommendedProtein={recommendedProtein}
                                currentDate={currentDate}
                                setCurrentDate={setCurrentDate}
                                todayStr={todayStr}
                            />
                        )}
                        {activeTab === 'workout' && (
                            <WorkoutSection 
                                selectedPlanId={selectedPlanId}
                                setSelectedPlanId={setSelectedPlanId}
                                workoutLogs={workoutLogs}
                                updateExerciseLog={updateExerciseLog}
                                toggleExerciseCompletion={toggleExerciseCompletion}
                                todayStr={currentDate} // Use selected date for workouts too
                                currentDate={currentDate}
                                setCurrentDate={setCurrentDate}
                            />
                        )}
                        {activeTab === 'history' && (
                            <HistorySection 
                                logs={logs}
                                deleteLog={deleteLog}
                                editLog={handleEditLog}
                            />
                        )}
                        {activeTab === 'settings' && (
                            <SettingsSection 
                                userProfile={userProfile}
                                setUserProfile={setUserProfile}
                            />
                        )}
                    </main>

                    {/* Mobile Navigation Bar (Fixed Bottom) */}
                    <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 safe-area-pb z-20 md:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                        <div className="flex justify-around items-center h-16">
                            <button 
                                onClick={() => setActiveTab('dashboard')}
                                className={`flex flex-col items-center justify-center w-full h-full space-y-1 transition-colors ${activeTab === 'dashboard' ? 'text-rose-600' : 'text-slate-400 hover:text-slate-600'}`}
                            >
                                <LayoutDashboard className="w-5 h-5" />
                                <span className="text-[10px] font-bold">Á∏ΩË¶Ω</span>
                            </button>
                            <button 
                                onClick={() => setActiveTab('diet')}
                                className={`flex flex-col items-center justify-center w-full h-full space-y-1 transition-colors ${activeTab === 'diet' ? 'text-rose-600' : 'text-slate-400 hover:text-slate-600'}`}
                            >
                                <Utensils className="w-5 h-5" />
                                <span className="text-[10px] font-bold">È£≤È£ü</span>
                            </button>
                            <button 
                                onClick={() => setActiveTab('workout')}
                                className={`flex flex-col items-center justify-center w-full h-full space-y-1 transition-colors ${activeTab === 'workout' ? 'text-rose-600' : 'text-slate-400 hover:text-slate-600'}`}
                            >
                                <Dumbbell className="w-5 h-5" />
                                <span className="text-[10px] font-bold">ÈÅãÂãï</span>
                            </button>
                            <button 
                                onClick={() => setActiveTab('history')}
                                className={`flex flex-col items-center justify-center w-full h-full space-y-1 transition-colors ${activeTab === 'history' ? 'text-rose-600' : 'text-slate-400 hover:text-slate-600'}`}
                            >
                                <History className="w-5 h-5" />
                                <span className="text-[10px] font-bold">Á¥ÄÈåÑ</span>
                            </button>
                            <button 
                                onClick={() => setActiveTab('settings')}
                                className={`flex flex-col items-center justify-center w-full h-full space-y-1 transition-colors ${activeTab === 'settings' ? 'text-rose-600' : 'text-slate-400 hover:text-slate-600'}`}
                            >
                                <Settings className="w-5 h-5" />
                                <span className="text-[10px] font-bold">Ë®≠ÂÆö</span>
                            </button>
                        </div>
                    </nav>
                    
                    {/* Desktop Helper */}
                    <div className="hidden md:block fixed right-8 bottom-8">
                        <div className="bg-slate-900 p-4 rounded-lg shadow-xl border border-slate-800 max-w-xs text-white">
                            <p className="text-sm font-bold text-rose-400 mb-1">üí° NO PAIN, NO GAIN</p>
                            <p className="text-xs text-slate-300">Êò®Â§©ÁöÑ‰Ω†Â∑≤Á∂ìÈÅéÂéªÔºå‰ªäÂ§©ÁöÑ‰Ω†Ê≠£Âú®ËÆäÂº∑„ÄÇÂ†ÖÊåÅ‰∏ãÂéªÔºÅ</p>
                        </div>
                    </div>
                </div>
            );
        }

        // Render the App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FitTrackApp />);
    </script>
</body>
</html>
